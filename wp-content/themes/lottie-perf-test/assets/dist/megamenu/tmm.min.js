class MegaMenu{static DESKTOP_BREAKPOINT=1210;constructor(){this.searchPan=document.querySelectorAll(".js-search-area");this.navWrap=document.querySelector(".navbar-wrapper");this.desktopNav=document.querySelector(".main-nav");this.navbar=document.querySelector(".navbar");this.hasUserInteracted=false;if(!this.navWrap||!this.desktopNav||!this.navbar){console.warn("Critical navigation elements not found");return}this.boundHandleMouseover=this.handleMouseover.bind(this);this.boundHandleMouseleave=this.handleMouseleave.bind(this);this.boundTrackUserInteraction=this.trackUserInteraction.bind(this);this.init()}init(){this.getTemplates();this.toggleTabContent();this.toggleSearch();if(this.getScreenWidth()<MegaMenu.DESKTOP_BREAKPOINT)this.toggleHamburgerMenu();this.toggleMobileMenuItem();this.updateMobileSearch(this.searchPan);this.handleScrollDirection();this.handleBack();this.handleParentMenuHover();this.handleNavbarHoverEffects();document.addEventListener("mousemove",this.boundTrackUserInteraction);window.addEventListener("scroll",this.boundTrackUserInteraction);document.dispatchEvent(new Event("tmmReady"))}trackUserInteraction(){this.hasUserInteracted=true;document.removeEventListener("mousemove",this.boundTrackUserInteraction);window.removeEventListener("scroll",this.boundTrackUserInteraction)}getTemplates(){const screenWidth=this.getScreenWidth();const isDesktop=screenWidth>=MegaMenu.DESKTOP_BREAKPOINT;if(isDesktop){this.desktopNav.querySelectorAll(".main-nav__tab-item").forEach(item=>{const{dataset}=item;const{id,hasSub}=dataset;if(hasSub==="false")return;const targetSelector=`#js-megamenu-${id}`;this.renderDesktopTemplate(id,targetSelector)})}else{this.renderMobileTemplate()}}renderMobileTemplate(){const mobileMenuTemplate=this.navWrap.parentNode.querySelector("template[data-id='mobile-menu']");if(!mobileMenuTemplate){console.warn("Mobile menu template not found.");return}const mobileMenuContent=mobileMenuTemplate.content.cloneNode(true);const mobileMenuContainer=this.navWrap.querySelector("#js-mobile-menu");mobileMenuContainer.appendChild(mobileMenuContent)}renderDesktopTemplate(templateId,targetSelector){if(!this.navWrap||!this.navWrap.parentNode){console.warn("Navigation wrapper or its parent node not found.");return}const templateElement=this.navWrap.parentNode.querySelector(`template[data-id="${templateId}"]`);if(!templateElement)return;const targetElement=document.querySelector(targetSelector);if(!targetElement)return;const clonedContent=templateElement.content.cloneNode(true);targetElement.appendChild(clonedContent)}handleNavbarHoverEffects(){const navbarElement=this.navbar;const navItems=this.desktopNav.querySelectorAll("li.main-nav__tab-item");const navList=navItems[0]?.parentElement;if(!navList||!navbarElement){console.warn("Required navigation elements not found");return}navList.addEventListener("mouseenter",event=>{if(!this.hasUserInteracted)return;const hoveredItem=event.target.closest("li");if(!hoveredItem?.classList.contains("main-nav__tab-item")){return}navbarElement.classList.add("navbar-active")},true);navItems.forEach(item=>{item.addEventListener("mouseover",this.boundHandleMouseover)});navItems.forEach(item=>{item.addEventListener("mouseleave",this.boundHandleMouseleave)})}destroy(){const li=document.querySelectorAll("li.main-nav__tab-item");li.forEach(item=>{item.removeEventListener("mouseover",this.boundHandleMouseover);item.removeEventListener("mouseleave",this.boundHandleMouseleave)});document.removeEventListener("mousemove",this.boundTrackUserInteraction);window.removeEventListener("scroll",this.boundTrackUserInteraction);window.removeEventListener("resize",this.toggleSearchElements);window.removeEventListener("scroll",this.handleScroll)}handleMouseover(event){if(!this.hasUserInteracted)return;event.currentTarget.classList.add("is-hover")}handleMouseleave(event){const navbar=document.querySelector(".navbar");navbar.classList.remove("navbar-active");event.currentTarget.classList.remove("is-hover")}handleParentMenuHover(){const menuLinks=document.querySelectorAll(".main-nav__tab-item a.main-nav__tab-item-link");if(this.getScreenWidth()>=MegaMenu.DESKTOP_BREAKPOINT){menuLinks.forEach(link=>{link.addEventListener("mouseover",()=>{this.clearTabItemHover();this.highlightFirstSubmenu(link)})})}}clearTabItemHover(){const tabItems=document.querySelectorAll(".js-megamenu-tab-item");tabItems.forEach(tabItem=>{const tabItemLink=tabItem.querySelector("a");const tabItemContent=tabItem.querySelector(".js-megamenu-tab-item__content");tabItemLink.classList.remove("is-hover");tabItemContent.classList.remove("is-hover")})}highlightFirstSubmenu(parentLink){const firstSubmenuItem=parentLink.parentElement.querySelector(".js-megamenu-tab-item:first-child");const submenuAnchor=firstSubmenuItem?.querySelector("a");const submenuContent=firstSubmenuItem?.querySelector(".js-megamenu-tab-item__content");submenuAnchor?.classList.add("is-hover");submenuContent?.classList.add("is-hover")}removeAllTabHover(){const tabItems=document.querySelectorAll(".js-megamenu-tab-item");tabItems.forEach(item=>{item.querySelector("a")?.classList.remove("is-hover");item.querySelector(".js-megamenu-tab-item__content")?.classList.remove("is-hover")})}toggleTabContent(){const tabItems=document.querySelectorAll(".js-megamenu-tab-item");if(this.getScreenWidth()>MegaMenu.DESKTOP_BREAKPOINT){tabItems.forEach(tabItem=>{tabItem.addEventListener("mouseover",()=>{this.removeAllTabHover();const anchor=tabItem.querySelector("a");const content=tabItem.querySelector(".js-megamenu-tab-item__content");if(anchor&&content){anchor.classList.add("is-hover");content.classList.add("is-hover")}})})}}toggleSearch(){const searchBtn=document.querySelector(".js-megamenu-search");if(!searchBtn)return;searchBtn.addEventListener("click",event=>{event.preventDefault();const searchContainer=event.currentTarget.closest(".search-area");if(!searchContainer){console.warn("Search container not found.");return}const searchInput=searchContainer.querySelector('input[type="search"]');if(searchInput){searchInput.addEventListener("input",e=>{e.target.value=this.sanitizeInput(e.target.value)})}searchContainer.classList.toggle("is-active")})}sanitizeInput(input){return input.replace(/[<>'"&]/g,"").replace(/[<>'"&;`{}]/g,"").replace(/javascript:/gi,"").trim().substring(0,100)}toggleHamburgerMenu(){const hamburgerButton=document.querySelector(".js-megamenu-hamburger");const menuElement=document.querySelector(".js-megamenu");const bodyElement=document.querySelector("body");const getStartedButton=document.querySelector(".js-get-started-popup__header");const backButton=document.querySelector(".main-2nd-nav__back");if(!backButton){console.warn("Back button not found.")}if(!hamburgerButton)return;hamburgerButton.addEventListener("click",event=>{event.preventDefault();if(backButton.classList.contains("is-open")){backButton.classList.remove("is-open")}getStartedButton.classList.toggle("hidden");hamburgerButton.classList.toggle("is-toggle");menuElement.classList.toggle("is-toggle");bodyElement.classList.toggle("is-menu-open");if(!hamburgerButton.classList.contains("is-toggle")){this.resetMobileMenuLabel()}})}resetMobileMenuLabel(){const mobileMenuLabel=document.querySelector(".mobile-2nd-label-menu");mobileMenuLabel.classList.remove("is-active");Array.from(mobileMenuLabel.children).forEach(menuItem=>{menuItem.classList.remove("is-active")})}toggleMobileMenuItem(){const mobileMenuLabelIcons=document.querySelectorAll(".js-mobile-menu__chevron__img");const mobileMenuLabelContainer=document.querySelector(".mobile-2nd-label-menu");const backButton=document.querySelector(".main-2nd-nav__back");mobileMenuLabelIcons.forEach(icon=>{icon.addEventListener("touchstart",event=>{event.preventDefault();event.stopPropagation();this.resetMobileMenuLabel();const targetId=event.currentTarget.parentElement.parentElement.parentElement.dataset.id;const targetElement=document.querySelector(`#${targetId}`);targetElement.classList.add("is-active");backButton.classList.toggle("is-open");mobileMenuLabelContainer.classList.add("is-active")})})}updateMobileSearch(searchElements){this.toggleSearchElements=()=>{const shouldActivateSearch=this.getScreenWidth()<MegaMenu.DESKTOP_BREAKPOINT;searchElements.forEach(element=>{element.classList.toggle("is-active",shouldActivateSearch)})};this.toggleSearchElements();window.addEventListener("resize",this.toggleSearchElements)}reRenderMobileElements(){const screenWidth=this.getScreenWidth();const mobileSubMenuItems=document.querySelectorAll(".main-nav__tab-item");if(screenWidth<=MegaMenu.DESKTOP_BREAKPOINT){mobileSubMenuItems.forEach(this.renderMobileSubMenuItems.bind(this))}}handleBack(){const backButtonElements=document.querySelectorAll(".btn-mobile-2nd-nav-back");const backNavigationElement=document.querySelector(".main-2nd-nav__back");backButtonElements.forEach(backButton=>{backButton.addEventListener("click",event=>{event.preventDefault();this.resetMobileMenuLabel();backNavigationElement.classList.toggle("is-open")})})}getScreenWidth(){return window.innerWidth}handleScrollDirection(){const navbar=document.querySelector(".js-navbar");if(!navbar){console.warn("Navbar element not found.");return}let previousScrollPosition=window.scrollY;this.handleScroll=()=>{const currentScrollPosition=window.scrollY;if(currentScrollPosition>previousScrollPosition){navbar.classList.add("is-scrolled-started");navbar.classList.remove("is-scrolled")}else if(currentScrollPosition<previousScrollPosition){if(currentScrollPosition>1){navbar.classList.add("is-scrolled");navbar.classList.remove("is-scrolled-started")}else{navbar.classList.remove("is-scrolled-started","is-scrolled")}}previousScrollPosition=currentScrollPosition};window.addEventListener("scroll",this.handleScroll)}}new MegaMenu;